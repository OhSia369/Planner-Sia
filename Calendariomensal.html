<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendário Mensal</title>

<style>
/* ================= FONTES ================= */
@font-face {
  font-family: "Arabic City";
  src: url("fonts/ArabicCity-Regular.ttf") format("truetype");
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  overflow: hidden;
  font-family: Inter, sans-serif;
  background: linear-gradient(
    135deg,
    #C9D1DA 0%,
    #C0C7D1 20%,
    #B7BFC9 40%,
    #AEB7C2 60%,
    #A5AFBB 80%,
    #9DA8B4 100%
  );
}

/* ================= MENSAL ================= */
.monthly-view {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100%;
}

.panel {
  background: rgba(255,255,255,0.28);
  padding: 14px;
  border-radius: 22px;
  box-shadow:
    -16px -16px 32px rgba(255,255,255,0.8),
     16px  16px 32px rgba(0,0,0,0.25);
  position: relative;
  cursor: pointer;
}

.header-monthly {
  text-align: center;
  color: #fff;
  margin-bottom: 8px;
}

.month-name {
  font-size: 22px;
  font-weight: 600;
}

.year-name {
  font-size: 14px;
  opacity: 0.85;
}

.grid-monthly {
  display: grid;
  grid-template-columns: repeat(7, 45px);
  grid-template-rows: repeat(6, 45px);
  gap: 0.2px;
}

.day {
  width: 45px;
  height: 45px;
  background: rgba(255,255,255,0.35);
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 12px;
  color: #222;
  box-shadow:
    inset 1.5px 1.5px 2px rgba(255,255,255,0.7),
    inset -1.5px -1.5px 2px rgba(0,0,0,0.25);
}

.day.sunday {
  font-weight: 700;
}

.day.today {
  box-shadow:
    inset 3px 3px 6px rgba(0,0,0,0.35),
    inset -3px -3px 6px rgba(255,255,255,0.9);
  background: rgba(255,255,255,0.45);
}

.dow-label {
  position: absolute;
  top: 2px;
  left: 3px;
  font-size: 9px;
  opacity: 0.7;
}

.day.empty {
  opacity: 0.3;
}
</style>
</head>

<body>

<div class="monthly-view">
  <div class="panel" id="panelMensal">
    <div class="header-monthly">
      <div class="month-name" id="monthName"></div>
      <div class="year-name" id="yearName"></div>
    </div>
    <div class="grid-monthly" id="gridMensal"></div>
  </div>
</div>

<script>
/* ================= UTILS ================= */
function doisDigitos(n) {
  return String(n).padStart(2, "0");
}

/* ================= STATE ================= */
// Pegar parâmetros da URL
const params = new URLSearchParams(window.location.search);
let anoAtual = parseInt(params.get('ano')) || 2025;
let mesAtual = parseInt(params.get('mes')) || 0;

/* ================= RENDER MENSAL ================= */
function renderMensal() {
  const monthName = document.getElementById("monthName");
  const yearName = document.getElementById("yearName");
  const grid = document.getElementById("gridMensal");

  monthName.textContent = doisDigitos(mesAtual + 1);
  yearName.textContent = anoAtual;

  grid.innerHTML = "";

  const firstDay = new Date(anoAtual, mesAtual, 1).getDay();
  const daysInMonth = new Date(anoAtual, mesAtual + 1, 0).getDate();
  const prevDays = new Date(anoAtual, mesAtual, 0).getDate();

  const today = new Date();
  let day = 1;
  let next = 1;

  for (let i = 0; i < 42; i++) {
    const cell = document.createElement("div");
    cell.className = "day";

    let dateNum;
    let dow = (i % 7) + 1;

    if (i < firstDay) {
      dateNum = prevDays - firstDay + i + 1;
      cell.classList.add("empty");
    } else if (day <= daysInMonth) {
      dateNum = day++;

      if (
        dateNum === today.getDate() &&
        mesAtual === today.getMonth() &&
        anoAtual === today.getFullYear()
      ) {
        cell.classList.add("today");
      }

      if (dow === 1) cell.classList.add("sunday");
    } else {
      dateNum = next++;
      cell.classList.add("empty");
    }

    cell.innerHTML = `
      <div class="dow-label">${dow}</div>
      ${doisDigitos(dateNum)}
    `;

    grid.appendChild(cell);
  }
}

/* ================= NAVEGAÇÃO ================= */
function voltarAnual() {
  window.location.href = `calendarioanual.html`;
}

/* ================= DUPLO CLIQUE NO PAINEL MENSAL VOLTA AO ANUAL ================= */
const panel = document.getElementById("panelMensal");
let lastClickPanel = 0;

panel.addEventListener("click", () => {
  const now = Date.now();
  if (now - lastClickPanel < 300) {
    voltarAnual();
  }
  lastClickPanel = now;
});

/* ================= SWIPE MENSAL ================= */
let startXMensal = 0;
const sensibilidade = 40;

panel.addEventListener("touchstart", e => {
  startXMensal = e.touches[0].clientX;
});

panel.addEventListener("touchend", e => {
  const diff = e.changedTouches[0].clientX - startXMensal;
  if (Math.abs(diff) < sensibilidade) return;
  
  if (diff < -sensibilidade) {
    mesAtual++;
    if (mesAtual > 11) { mesAtual = 0; anoAtual++; }
    window.location.href = `calendariomensal.html?ano=${anoAtual}&mes=${mesAtual}`;
  }
  if (diff > sensibilidade) {
    mesAtual--;
    if (mesAtual < 0) { mesAtual = 11; anoAtual--; }
    window.location.href = `calendariomensal.html?ano=${anoAtual}&mes=${mesAtual}`;
  }
});

panel.addEventListener("mousedown", e => {
  startXMensal = e.clientX;
});

panel.addEventListener("mouseup", e => {
  const diff = e.clientX - startXMensal;
  if (Math.abs(diff) < sensibilidade) return;
  
  if (diff < -sensibilidade) {
    mesAtual++;
    if (mesAtual > 11) { mesAtual = 0; anoAtual++; }
    window.location.href = `calendariomensal.html?ano=${anoAtual}&mes=${mesAtual}`;
  }
  if (diff > sensibilidade) {
    mesAtual--;
    if (mesAtual < 0) { mesAtual = 11; anoAtual--; }
    window.location.href = `calendariomensal.html?ano=${anoAtual}&mes=${mesAtual}`;
  }
});

/* ================= INIT ================= */
renderMensal();
</script>

</body>
</html>
